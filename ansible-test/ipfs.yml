- name: labels
  command: oc label nodes  {{ item.0 }} {{ item.3 }} --overwrite
  with_items: 
  - "{{ ipfs }}"
  register: command_result
  changed_when: "'\" labeled' in command_result.stdout"

- name: add-scc-to-use ipfailover
  command: "{{ item }}"
  with_items:        
  - oc adm policy add-scc-to-user hostnetwork -z ipfailover
  - oc adm policy add-scc-to-user privileged -z ipfailover
  - oc policy add-role-to-user system:replication-controller system:serviceaccount:ipfailover:deployer

- name: Create routers
  command: oc adm router router-{{ item.5 }} --replicas={{ item.1 }} --selector={{ item.3 }} --labels={{ item.3 }} --service-account=ipfailover
  with_items:        
  - "{{ ipfs }}"

- name: add-scc-to-use {{ item.5 }} service acc
  command: oc adm policy add-scc-to-user privileged system:serviceaccount:ipfailover:router-{{ item.5 }} 
  with_items:
  - "{{ ipfs }}"

- name: IpfailOver
  command: oc adm ipfailover ipf-{{ item.5 }} --replicas={{ item.1 }}  --selector={{ item.3 }}  --images=openshift/origin-keepalived-ipfailover:"{{ openshift_image_tag }}" --virtual-ips={{ item.2 }} --watch-port={{ item.4 }} --service-account=ipfailover --vrrp-id-offset="{{ item.6 }}" --interface="{{ item.7 }}"
  with_items:        
  - "{{ ipfs }}"
  ignore_errors: true
